{% extends "website/base.html" %}
{% block content %}
<section class="page uploads">
  <h1>Uploads</h1>

  <form method="post" enctype="multipart/form-data" class="upload-form">
    {% csrf_token %}
    {{ form.non_field_errors }}

    <div class="field">
      {{ form.segment_file.label_tag }} {{ form.segment_file }}
      <small>Accepted: .csv, .xlsx, .xls</small>
    </div>

    <div class="field">
      <label>
        {{ form.auto_index }} Auto-calculate index per route (if blank)
      </label>
    </div>

    <button type="submit" class="btn primary">Upload new segments</button>
  </form>

  {% if result %}
    <div class="result">
      <p>Created: {{ result.created }} | Updated: {{ result.updated }} | Skipped: {{ result.skipped }} | Errors: {{ result.errors|length }}</p>
      {% if result.errors %}
      <details>
        <summary>View errors</summary>
        <ul>
          {% for e in result.errors %}
            <li>{{ e }}</li>
          {% endfor %}
        </ul>
      </details>
      {% endif %}
    </div>
  {% endif %}
  <h1>Run updates</h1>
  <form method="post" action="{% url 'queue_update_segments' %}">
    {% csrf_token %}
    <button type="submit">Run updates</button>
  </form>


</section>
{% endblock %}
